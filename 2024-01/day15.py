import dataclasses  # noqa
import sys

_input_sm = """
########
#..O.O.#
##@.O..#
#...O..#
#.#.O..#
#...O..#
#......#
########

<^^>>>vv<v>>v<<
""".strip()

_input_md = """
##########
#..O..O.O#
#......O.#
#.OO..O.O#
#..O@..O.#
#O#..O...#
#O..O..O.#
#.OO.O.OO#
#....O...#
##########

<vv>^<v^>v>^vv^v>v<>v^v<v<^vv<<<^><<><>>v<vvv<>^v^>^<<<><<v<<<v^vv^v>^
vvv<<^>^v^^><<>>><>^<<><^vv^^<>vvv<>><^^v>^>vv<>v<<<<v<^v>^<^^>>>^<v<v
><>vv>v^v^<>><>>>><^^>vv>v<^^^>>v^v^<^^>v^^>v^<^v>v<>>v^v^<v>v^^<^^vv<
<<v<^>>^^^^>>>v^<>vvv^><v<<<>^^^vv^<vvv>^>v<^^^^v<>^>vvvv><>>v^<<^^^^^
^><^><>>><>^^<<^^v>>><^<v>^<vv>>v>>>^v><>^v><<<<v>>v<v<v>vvv>^<><<>^><
^>><>^v<><^vvv<^^<><v<<<<<><^v<<<><<<^^<v<^^^><^>>^<v^><<<^>>^v<v^v<v^
>^>>^v>vv>^<<^v<>><<><<v<<v><>v<^vv<<<>^^v^>^^>>><<^v>>v^v><^^>>^<>vv^
<><^^>^^^<><vvvvv^v<v<<>^v<v>v<<^><<><<><<<^^<<<^<<>><<><^^^>^^<>^>v<>
^^>vv<^v^v<vv>^<><v<^v>^^^>>>^^vvv^>vvv<>>>^<^>>>>>^<<^v>^vvv<>^<><<v>
v^^>>><<^^<>>^v^<v^vv<>v^<<>^<^v^v><^<<<><<^<v><v<>vv>>v><v^<vv<>v^<<^
"""

_input_lg = """
##################################################
#OO#..O#......#...O.O..##..O.....O...O.......#...#
#...O.O...O.OO.O....O...O.#...O...OOO#O..#.#..O.##
#..O.O.....O.....O..OOO.#OOO...O....#.#.OO....OO.#
#.......OO#....OOOOO#...O..#...#..OO#O.....O.#...#
#......O..O....O....O......O..O....O.O#...#......#
#...OOO..O..O..#..#.....#O.O..O.....##..#..O.OO#.#
#..#O.O..OOO..OOO..O.O.OO......OOO.........O..O.O#
#...O.#...O##O....#O..OO.O..O.O.O....O....#......#
#.....O.O..OO.O.....O......O.#O...OO.O......O.OO##
#....O.#O.....O...OO.O.OO......O.O.O..........#O.#
#...O..O.#.O..##.O.OO.O.O.O.....OO.....O.O...O.O.#
#.........O#.O.O...O.#..O...........O#..#.#OO#...#
#O.#..O.#.O....O....O.O..#.O..O.OOO.O..##..O.....#
#..O..OO....#..O..O........#.OO...#...O##..O....O#
#..O...#.#O#..O.O..O.#.OO.#.##O.O.#O..OO.O.OO..O.#
#O#..O..#.#O..O.....O.O.O..O..#O....O..OO.......##
#..OO..................##.#.O...O......O.O..OOOOO#
#....OO....OOO........#O....#O#.##O.O..OO.O#.....#
#..#.......O.....#....O..#........OOO.#.O.O..#.###
#..O........OOOOO......O.O#..O.OO#....#....##....#
#.OO.#....O..#O......O.O....#...O...#..OOO.....#O#
#.O.......#O...OOO.OO.O..OOO...OOO.##...O#OOO.O..#
#O##O..O..#......OO.OOO.#OO....OO....O...OO.#.O..#
#.#.O.....O..O.O..O..OO.@.O.O......O.....#O##O..O#
#....OO.........O.....OO...#..#...O..#O#.....OOOO#
#.O.O#.O.......O#...OOO....O.O.O#.O.O..O.........#
#O..O.OO...O..OO...O.OOOOO..OOOOO.....#..#..O.O..#
##.O....OO..##...OO...O....#.O....O#.##OO.O#..O..#
#.O.O.OO.....O.#.O.#.....OOO.O...O...O#.O.....O..#
#.....O..##O#.....#.O...O....OOO.#O.....O.O.....O#
#...O..O#.O..O.##..O...O....O.#....OO...###O....##
#O...O.O....O.OOO...##.O.#...OO.O.......O.....O#.#
#..O..O..O.O..##O..#..O...#.....O.......OO...#.O.#
#O##..O.O.....O.#O#......OOO.......OOO...O.O#..O.#
#..O.O.##O..O....O.OO.O......O.O.OOO.O#..O.O.O#OO#
#...#..OO#O.#O.....O.O.O...O.O.....O..OO#....O#.O#
#O......O.O...#.O....O...#O.#......O...#.O#O...O.#
#......O.#...OO...O.O...O..........O......O..O.O.#
#..OO.O.O#..O.O....O.O.O..O..O.#..#.#.#O......OO.#
#.O#..O....O..OO..O....#....O..OOOO.O.#..O.......#
#O.........#.O...##..O..#...O...OO...O...O......O#
#O.O........OOO..O..........O...O#.O..O.O...O....#
#O.O#..O.O..O.OO..OO...........O...OO......OO.#.O#
#O##..........#..#.O..#.OO.O...........OO....O..O#
#....O....#OO..#O#..O.......O..O.O.O..O#.O.O..O..#
#............O.#.O.O.OO......OO.O.O.O.O..#O.OO.O.#
#O.OO......O.#..OO...O.....O.#..O..OO..#.#OO..O..#
#.......##.OO....O.OO.#..O.O.O..OO..........OO..O#
##################################################

vvvv<><v<>vv<>^vv>>>^<v>v>^>><>^<^v<>v>>><^><^v<>^v><<<><<>v<vv>v>^v^v<^vvv>>vv^>^vv^^v<^v^>^<^><<v^<<<^>v<^^>^^<><>><<<^^v><>^^^<<vv>^^^^<v<vv^>><v<^^vv^<>vv<v<^v<v<>^>^<<><vv><<^^<v^>vv<^<<v<v>>^>v><>^^v<>>^vvv^^^^<>vv>v^^<>><^>v<^<>^^^^v<>>v>^v^<v>^>>v<vv^^>>>^>><^vv>vv^v<v<v<^>><><v>>^>>>v<>^^>^^<<v<vv<<<v<v^>^<><<<>vvv^<vv><^^<v<<<<^<v<v<>^^<^^<^><>^>^<<<<v<>>>><>^<^^><>>>^^><v>v<<^>><<>^<v<<^<^v^>v^>>>vv^vv^<vv^>vv^>v^>v^v>v<^v><^^vv^<<>^v<<^v><<><<<v^><v^^vvv^>^^>^vvvv>^>v>^^<^v>><>^>^vv<<vvvv<^^^<<vv^v^>>><>>v>>>v>>^<^v^>v^^><vv^^vvv<^v>^>><>v><vv<^^>^<><v^<<v<^><v><^<>>>^v>>v><><>v^^>^^<>^<v<<vv<<><><<^^v^>vvv^>v><^^^^^><vvv<<v>^v^^v<><<^<>v^^^<<vv<<^v>v^<>^^>v^vv<v^<<vv<<<>v^>v<>vvvv>vv^^<>v^><^<^<^^<>^^v<<v^vv>>^>>>v<<>v>>^<^<vv<^>^^^^v>^^^v^>>>>vvv^vv>vv^^>^v>v><<v^<>^>>>>v<^vv<^v^v^^v^><v<v^v>^>>vv<<<^^^<>v<^>>>^>v<^>^^<<v^<v<<<>>^<>><^<v^>vv<>v>>><>v^<^v>^<<^<vvv>v<>v<v<<<>vv^vvv^<^v^>vv>^<<^<>v^<^^^<v>^^v<<v>v^<<vvv^>>^<v<^^>>>^^<<<vv<^^^^<>><v>><<>v^v<^>>>^<<>^^<>>^v<<>
v^>><v><vv^^^><v^<><^^>>><<^vv<<<^vv>vvv<v><^v<<v>v^v^^<>^^>>>><<vv>v>>v>v<<<<<^v>v^^<>^^>v^<^^v^vv>v>v<<><<><>>>^<>>^v<>vv^^^<>^<<vv>v^<^><v<v<>^v>^^^^^>>>^<vv><^<<>^^^<^<v>^>^>v<<v^^v>^><>v^<^v^>v^v>^^v^>v>v^^v><>>^>^>vv^>^>^^>^<>>^>v^v>>><<^v>vv>v>v^^^>><^^^<>^><v^<<<<^<<^^v<>>^>vv^v<v^^<<<vvvv^<><^>^<^<^^<><vv<v<v<<<<^v^^<<>^^v^^^vv<v<v<<><>v^^^vvv<v>vv^^<^<^<<^><vv>^<>^v>vvv<^<^<^<^v<^v>>><<vvv>v<^v<>>>>^>>^v<vv^^>v^v^v<<>v>><^<^<>v>>^<v<>>^<<>^^<>vv><>>>^^><^vv^>^v^<>^v<<^v>^<><<^><<><>>>vv>>>>^v^<>>v<v><><><v>>^><>v^^>^<<<><vv<^<^>^><v^><<>^<<v^v<^^v><vvv<<v>>^^v>><<^<^<vv><vv^><>^vv^<<<v^>^v<v><vv^vv<^^^>vv><<v><<vv^>v>>^v^<<^vv<<><^>v<<<^v>^<>>^><^>>v>^>>v^v<<^>vv>^v><<v<^v>^^v><^v^^v<<v^<v<^<^>^v^v^<><vvv<>^<^>>>v<v>v^^<>^<^><>^<>>^v>v<<v>^v^>>^>^^^^v^^><>vvv>v<>><^vv<>><^><><v>^<>^<<^^>v<^<>v<v^v<<>v^<<<^>^><^^vv><><vv^vv>v<^<^<>^<<<>v>v^v<v^<^v><^vv^^^>^^<^^^v^<<>>v^^><<v^>vv^>^^v^v^<^^<^><vvv<<vvv^<><>vv<v^<<v<^v<<v>^^^<<vv^^v>>v><<^<>>vv>^v>v>>>vvv><^<<^v><vv^^<>>v<>><v>^
v<v<>>^>vv>vvv>^>v^<^<v<^^>v<^^>v>^<>>>^^<><><^^>><>^<>^>v<^v^<>v^v>^v>>^<^^^^v>><><^^v<<v<^v><<v^<^v^^^^<<<<><<>^^>v^>v<^v<<v^v<<^^v^>>>>^v^>v^<^vv><vv<<^v>v>^><^<>^^<v^<<<v<^>><>v<>^>^<>><^>^<^v^<><v<^>>^^<vv^vv^>><^v>v^><v^<<^vv<v^<<>v>^v<vv^>v>vv^^v<>>v<<><^v>^>v<v<<v<vv>^^>v<<^^^><^^<<^vv<^v^>^>v^<><^<v^^^v<<<>><>><v<>^v><<v^>^>^>^v^>vv^^><^^vv^>v^v<<>v^<v^<v^v>><<><>^>v^<^<<>>v<><>>^<^^>^^v>^^<<v<<<^>>><vv>>><<>v^>>^<>v<v^><v><v^<<><v>^v>>^v^^^><vv>>>>^>>^^>^>><>>v^<^>v^v<<v^><^v>>^^<^<^<>^<<^v^v^>vv^v^><^>^<<>>>^<>vv><^vv><<<>v^v>^^<<<^<v^><>v>vv>>>v<<<^^v>vvvv>^^^v><<<^>>v<v<<^<>>>><^v^<v<<>^^>>vv^^<v^vvv^v^>>>v^<<><^>^<<^^<<vvv>v<^^<v>^^<>>><v>><v^^<>v>^v><^vvvv<^v<>>>vv^<<^><<<^<^^vv>^<>v>v^>><<<>><^^^>><><>^>>^^^vvv<^><v<<<>>>>>v><<>>>><v<<<>v>>v>v><>^>^v>^<<v^>^vvvv>v><v<<<<vv<><><><<^^<>^v<^>>>>>v^<^>><^>>>^>v^><v>vv<^^>><^v><^<<^>><>^v<>^vv>^<<^<vv>>>^>^^>^v<v<v^vv>^v^^<<>v>><^>^v>v^v><<<>><^^<<vv<><v>v^^^>>>v^<^<<<><><v>v<v<>>><<v^><>^v^<>^<v^>v<^v^^>vv^^>><<<>v>^vv><^>v
v>v^^v^^^vv<<<>^v^<<^>v^>vv^>^^<^<^v<>><^^v^<<<><<^<<^<<<<><v^vvv>>^><^>><>^<^><^v<>v^<^^^^<>^^<v<><<^vvv<<>>><<^<v><^^><<^^v^<v>^vv^^>v^><<v^vvv<^<vvv>>vv><<<^^><<^^^<><>v^^^v^>v><^>v>^v>^<vvvvv<^vvvv>>v<v>^^<vvv^v<<<<<^>^<><v<>>>^>>>>>^>>>v>vv^>^>v<>^>>^v>>>>^v>><^><vvv><^>>^vvv><v^>v^^<>^v^<<v<<>v<vv>v^<<^<v^^vv<<<>v^^>^^<^><>^>>v>vv>vv<<>^^^<<v^>^>>>vvv<v^>^vv<^v>^v<^^v><>^^>v>>v^<>>^vv><>v<>v<>>^vv>><^<><>>^<<>>v><<>^vvv<<>>>v>v<v>^<<v^vv^>^v>^v^<v^v<>v<^<^^<<v>v>>^>v>>vv><<><>^><v<><><v>v>^<<<^><>v^v>^><v<<v><<vvv<^^v>>v<>v^>>><>><>^>^>>^<^><>>v>v>v^>^vv><>>vvv<v>v^^^>vvv<v><<<^v<v<<v^<v<<vvv<v<>^^vvv>v>>v>><^v^<^^v>^^<><<^>v<v^v<^^>vv>^<>^>>vv><^><><vv^v<^<<<vv^^<>^>v><vv^><v^^<^<^<^>^><<<^v><v<>v^v>^^<>v^>><>^<^<v<><>vv>vv>vv<^<>v^v>^<^<<<v^>vv<v<^vv<^^vv<^<^>^>^v>^v>>^^v<^<v>>^vvv<^^v<<<^vvv>>^^>><v^<<<v>>^>>v<^<^^^>>>v<vv<v^vv^^^<^vvv><^^vv<<vv^<<v><^<vv^v>vvvv^<<<v^<<^^v^v>v<>>>>^^v^>vv<vv<^^><>>v>^^v^<>^v^^^v<<<v^v^><<^<<>^>^>^<^^v^v><^vv><^>^>v>>>>^>^v^<v>vvv<>^^v<^><^v<vv
<^>>vvv<>^<<><v^>>><v<vvvv<v><<>v><>><v>>^>v>^vv>v^v^^v>>^<>vv>v^<>v^<v<v<^^v^>^<vv^^^^^<><vv^v^>vvv<v<><>>>^>^>>^>^^>^<^^^<>vvv>>vv^v^>^>>v^^^v<^v^v>^<<><>v>><>><<>^><<v>v<>>^>>^<<v<>v^v>^v<^v^<^><v^<<^<^^vv><>v<^vvv^^^vv^<v><>>vv<^<<<<^<<v<^<^>v^>v>><v^v><>^v<v<vv<^^^^>vv>>v>v^><<<v>^v>v<><><^>><>v>^^>v^<<<^v>^<<<^^><>v>>v^^v>><<v<<vvv<v<v^vv<^^v<^<v<><><^>>v>v^<^<<^^<vv^^><>>>v<<v^^>^>><><v><^<<^>>vvv>v>^v^<vv>>^^^>>>^vv^vv>>^><><>^v>><v<^v>^<^<^^<^<^vv<^^><<>>>^<<<>^<><><>v>>^><v^<<<vv^>>><<><>>v<v^vv>>^<^>v><><>^v<<>^<>^><v><>^^>v^<<v<^>><><<vvvv^^<>>^^>><>vv^<>^^<v>vvv^^v>>^^>v<>^^><>v^vv^v<vv<^>v^^v^>>>^^v><><<^<<>^^^^<>>^^>v>><^^>^<vv<>><<v^<<v>^>><><^v^>^vv^^><vv>v><<v^vv>v<>^^>>v>^v^^>v^^>v^><^<vv<<^^^<>vv<v>v>v>>><vv>v<>^<>vvv><<>>v>^^^^>>vv><v>v<>^<^^^>>vv>>^<>><<<^^<>^^><^>v><><v>^>v<^>v><^v>v>vv^vv^>>^><^<v<v><>^>><^^^^<>vvvv>><v^v^^v>>v^<<<^^^>vv<<^^><v>>v^>^>vvv>^v^^^<<v<^v<^^>^><v>>v^v<^^^v^><^<v><>>^^>>^<v>^>>^<^v^^<^><^vv<>v^v^>v>>^<v><<>vvv>v>v>v^>^<^^<<v^v>^^>v>vv^
^<^^^v>>v<^<>>v^>^^^<>>^vv^>^>^vv<>^vv>^><>^^<^^>v<<^<<>><<^<^>v><^>v^<><<<><<vv<^<^vv>>^>v<<^>>>>v<v<>>>>^<<^><v<>>v^^^>^<><v<<^^<v^^v>^^v^><^>^v<>v>^<>v<vvv^v>>v<>^v^<>v>v<vv<^v^>>^v^><<<^<^<>^>vv^>>vv>^^^<^>>>v^^^v><v^v<^^<<v^^<v<>^>>v^<^>><<^><><><><v<>>><><<>v<<^<v<<>^vv>v<v<v^<^>><><><vv^>^<<^>><v<v<><v>vv^v>^^v<v<vv^v<>><<<^>^>>>v<<vv>v><vv^vv^^^>v^^^>><<>v^>>^v><<v<>^><v>^^v<^>v<v^<>>^<v<<<<>>v>^v<vvvvv<>^>>vv^<>v><<>^v<^>vv^>>^^>><>^vv>vvv^<<<vvv<^<vv<^<<<^<v><v^>^>^^v^>v>^v<v>^<<>^>^<^v>^>^>>v>><^<^>>>^<^^^>^v^v<vv>><>>>v>v<v<<>v^<v^<^v>>>v^^^>v^^>><>>^v<v>v^^^v^^^>^v^^<^>vvv<^<v<>>v>v>^<<><^><>><<v^<<v^>v^>v<^>v^>>v^v<<^v^v^^>v<vv^^^v<^^>v^><<>^<<<>vvvvv^v<^^v^v^v<v>^^>v<^^<<^<v^<<<>>><<v>vv^^>^^>>v<>>>^><<>>^vv<^<^^<vv<<^>v>^^>>^>>^^>^>^v^<v<<^>>v<^<^v>>v>^v>>>^>^^>^<><<v^<^^>><<<<<v<<>>>^>vv^>^^^^<v<<>>^>>^v>^^v^<<><<><<<><<^^^v><<vv>v><>vv>vvvvv<v>^<^>^^v>><v<>v^^><v>>>v^v^v<v<<>v<^<>^<vvvv^><^<><^v><<^v<<^<v<><^><v>>><^<<><v>^v^>^v<<^<<^^vv^>><v><>vv>><<><>>><v>^v<^v><<<
v>v><v<<v^^vvv<><<><>>^><<><<>vv^vv<><v<<>^v^<>><^v>>>^^vv>v^v<v<<^<^<>><<><>^><^v<^^>><v>><v>^v<^^>>><<v>><<vv>><<>^<>v<<<v^^<>>^v^>^<<v<^<<>^^^<^<>>^><<<^vv<vv>>^^>^v>vv^>^>v<<^v<v<v^v^><v>>>><^v>v>^v<v<<v>v<^>v<vv^v<><^<^<<v><^>^>^^^^v<<v>^<v^^^><^>>><^<v^>><<^<>^<>^v<v<v<v>^>>vvv^v^^v>vv><v^>^^<v>v^><>v<^vv^^v^<vv><vv<<>^<v><>v^v<vv><>><<><^v>^><^vv^^v^v><>><>>^<v><>>^><<<>>^<<v^><^<<>>^v<<^<<v><<<v^^^>^<>^>>^>^^^<<^v><<>v^<>v>^vv<v^^>>^<^<^^>><vv^v>^>><<<v<<^<<<><^<^^v><<v><v>v<<v<<^<^^v<>^^<v^<<^v<>v>^<<^>>>><>^><v>v><^^<<^^<<><^<<^>^^^^v><v<<^v^v^<vv>^<^<>>vv>^><><>v^^v<><>>^^^^>>vv^v<<>^>^v^^^v><vv<v^<><^^>>>^<<<^>v><>vv<^^^v^v>^^v^><<vvv>^vv<v^>^><>><v^vvvv^^v^<^^v>vvv><^<v<>v<<^v>v^<v>>>^^v^>v^<>^^><>v<^>v>^v><^<^>v^<^>><v^>v<^<>v<>>><v^>^>>>v^^><>>^<<^<^^^>v>>v>^v<>>^<<<<<^<^<<^^v^^>>><v^<^vvvv<^><v<v^^v^v>^v>^<<^^>><v<v^^>>^^<>v<<<>v<<<<v^<<^<^v><>>>v<^<^vv^>vv<v>v^^>^vvvv^v<>v<<v>^<^>>>^v<v<>^v^<<vvvvv><<>><^v>^>vv^<v<vv<^>^>>v<><><>vv^<>vv^><<<<<<<>>^v<<v><^^<>>v^v^<<v^^^
^<>v^^^vv^v><>^<>^>v^v>v^v<><v<^>^v>><^<<^v<v<>v>v><v>v^^v>vv<>>v<<vvv>^v>v<<^<>>^v>^<^^>^^^vv<<v<^v<>^>>v<<v<>^v^>vv^^<^>^>^<v<^>^^<<<<><>>v<v>>v^v>^><^^>>>^<vv^^v>v^v^v^<v>>^^vv^^^^<^<<<^^<>>v><v><<^<vvv<v^^v<v>>^v<>v^<<v^<><<<<^v<v^v^v^>>^^><<v<<vv^v<<>^<<v^<>^v<^vv^<<<><<v>v<>>v>^<>v<v^>^<>v>^v><^^vv>>>^<^^^<^^^^>v>^vvv^vvv<v^^<>>^vvvv^<>vv<><<>^^>v>>^<><<<^<>><^v<^<vv<^><<^>vv^>>^<^<<vvv<^v>>v^vvvv^<<v<>v^v<><>>vv^<v^v<<v^<<<v<^>v>>v^<^<>^>v^^<vvv<>v<>^vvv^v^<^^vvv^<^<<^<><<><>vv^><^>^><^^v<<>^>^<>>>>^vv>><^<vv<^<<vvv>^v^^^<<^v^>><v^v<>v>>v>^vvv^^>v<>^^vvv^^>^v>^>vvv>><^<v<<v<><<<>v^vv<<><<><>>v<v^>^v>^v<<^^^^>^<>v<vv><^vv^^^<>v^<<<^>v<<^^^^v^<^>^><><<<v^<>^^>^<<>^>vvv<><<<^<^>v<><vvv^^^<<^v<<<v>>^><<v<<<^^v^>>>v^<><><<>^<^^^><>v<v<^>^vvvv>^<vv^>><^^<<v>v<^><<<><vv<><v^^v^<<v><^v^^<>><vv^>^vv^>^>v^<^^^<<<^v>^v^<<<^vv<>^vv<>^>><><^v>><^^><>>^><>^^v<v><^<<^^v<><<vvvv>>><v^<v>>v<<<><^v^^^>v<^v^><^<<^v^<<><v^^^v^>v<<<v><^<^^vv<>>v<<>^<<^^<><^>^<<v^v^>>^>v^v^<^^vv<^<<<<<^<v^v>^<v^<>^>^
><v^v><<^vvv^<v>^v^v<^v^v<>v<^^>v>>>>>v<<vv<<v<^<>>v<v^>v^>^<v<^><<^^^^^v<^<>>v>v>^^>vvv>><^vv>^<vv>^>vvv<^>^v>^^<^>^<^vv<vvv^>>^<<>v<<v^<<<<v<><^v<><>vv^v>^<^>vv>v<^^^>v^<<>>><vvvv<v<>>><v^vv><<<v^vvv>><^^^vvv>v^<<>v^v>vvv<^>^vv<>v^vv^^>>>>>><>^vv^v<v^<<vvv<><><^<<<v^<v<>^^^><>>^<>^<v^vv<v^v^<>v>>vv<><<^<^^<^>^><v>>>^^<v>v<^v^>>>^>>><vv>^>>^>>^<>^<<<<vvv>v>>>^<>>v<<^v<v><><<><<<^^^v^<v^^v<^<v^<<^<>vvv^><<><>><^><v^^>>^vvv<>>^v>>v<v><^^<<>v>>^v><<>^^>>vv<^<<>>v<vv^>v<v>v>^>v><<^<<^^^>>>v<<<<^^^<<<vv<><v<>vvv^>><>><>><^v^^<^<<v<^v<^v<^^>^<^^>>>vv^v<<vv^>>v>v>>>v^>>><v>^vv^<^>^><^^v<v^<^^v<^>>>>>vv><<v^v^vvv^^<^<^<v>^^^><<v><>>v><^<>>^v<vv^<v^>>^>^v>>><v><>><^<vvv<<v<>>^>^>^^<^^><v><<^v^v<>v^<<<>>><v^>><v^>vvv>v<^v^><^>>^<>^^>v<<^v<><>^>>v<^^>^>>^<<vv>vv<vv>>v>>>^^^vv<>v<><>>^vv><<^<vv^>v>>v<>^v>^<<<^<<<>v^>^<<<^^v><<>^<v>vv>^>v>>><<>v>>vv><>^^v<^^<<<v>><v^><v>vv<>><^v<>v^><<^<>>v<^^<>^>v>v>vvvv^<<<v>v>^^>><^<vv>^vvv<^v>^<>vv<<<v>vv<^^><^<^<vvv>>><v>^^>v<^^vvv^v><<v^<v<<<vv<><v>>^^v^^^^>
^><^v>v<<^>>vvv>><v^>>v<^v><>^v>v^v<<^<vv^^<vv^<^><^>><>^v^vv>>vv^^^^v>v>^v<v>vv>><<>^<v>^vvv>v<<^<^v<<^v>v^>^^>^>^<<^<^v<<<>^<^<^v<v>^^^<v<v<><^>^v>^><<vv<v><^<vv^v>^>v>>>vv^<<vvvv^>^v>^v<v^v<>>v>^v<>><>vv^^^>^vv<>v<v^^^<^<v<>^v^^v^>^<><<>>>^>^^^^^v^>vv^^^<><v<vv<><v<<><><vv<<v^^^^>>^><><^vv>^v^v>>^vvv^^^^v<^^^<^^^v>v<^>v^>>v<<<<vv^<>vv<>v^^><>v<>vvv^^<v^^^>v<>^vv^<<<<v^>>>v^><v<><><v<^><>v>>^^vv^<v>^>v<>v><<<<>>^<^>><<^v>v<^>v>v^v<<<<>v<<>>^>v>v>v^v<^v>><<>^v>v<v<^><vv<v>>>v^<<^v^^vvv>v<vvv<>^<>v>^<><<<<^^^<^^<<^>v^<>>v^<>^v^>>>v^v>^^<<v^>>>v>v><<>vv<^<<v<<<v<>vvv>v>vvv^^<>^<^^vv<<^^>v>^<<^>^><>v^<>v>vvvvvv<^^vvv><>>><>^>><<v<>^<^v<vv>^<><^v<><^>v^>v<<^v^^^><>^<>><^v<^<v^v^vv>>^vv>v^<v^><<<>v><<^^><<^<vv^^^^>^><^<^v>>vv^^v><<<>^<>v^>v<vvv>v^<>^>><^v>^v^<^<v>^^^>>><<<><^vv>vv^<<<><><>>vv<><^^<vv^^<<^<>v>vv<<^<^>^<<v>>vv^<><vvv>v>v>^v^>vvv<>^>><vv^^<<<<^^<<v<<>^>><v^v>v^^^^>^^<><><v>^v<>v<v><v<v<^>v>^<^^>>><^><^<^^^<>><<^^^>^^v><^v^vv^v^v^><^^>^^<<^^<v<>>^^>>^>vv<>^v>v><v><><^^vv^<^>v<
^vv<v<v^<^v>^>v^>>^^><<v>v>vv<v<vv>^^<>^<>>^<<v>^^^^v^^<<v<v<<^<<<vv^<<^^v>v<><^^>^^<^>><vvvv<>>><>v^<v<^^<^<v<^<>^>^><>>^<><v^^vv<^^>^<><<^^^v>>>v^v<^<^^<^>^^<<^>>>v>v<^^>vv>v^<^^<v>>vv>><^<<>>vv><v^><v<^^<<>>v^^<v<<^>v<^vvv^>v<^^^vv<>v<vv><>^v<^<>>^^<^^v>^vv<>v<v>v^vv<>^v<^^<v<<<^^<v><^<^^v^^>><^>vv^^v^^^vvv<^^>vv><<>vv^<^^>v<>^<<<vv>v><<^vv<<^<<<v>v^v<v>v^^<^><>^<<v>>>^vv><^^>v><^<vvv<^v^vv<<<v<>>v^<><<^v>>^v<>v>^><vvv<<^<v<><vv<<><>^>v>v^<^<v<v^<<>^^><><>^<v^<^v<^<v<<>^^vv<<<<^>>v>v<^^v^>vvv>v^>^<v<^v>><vvv^^v>><<<<^v<>^^>^>v^^<^><><>vv<<^<v<vvv>^<^>^v^^>^vvv^^v^<v^v^^>^v<v<<<>><^>^v<<^^<v^<>v>>^^v^><><^<^^<>v><>^v^<>v<><<><>^^<>^^vvv>vvv>>^<^<>>v<>^<<v><><^>^vvv<v<v^vvv^>vv^^vv^<><<^>^>v>vv><v^vv<<v^^v>v<><vv>><<v><vv<^v<<^><<v>^vvv>^>>>>^<v^>^^v><v^>^v<v^v^^v^v^v>vv<>vv^<vv<<<>^v>^><><>v^<>>vv><vv<<>v^<v>vvvvvv^vv>^^<>v>v<v^>^><v<^vv<<v<>^<v^>^^<vvv<v^v>^><^><^^v^>>>^^><v>^<v>vv<vv>^<>vv>^>>^^>><^>>><v^<vv>^<<><^><<v^<<>v>>^>><v^v>>^<<v>^vv>>v>vvv<>>^>^>>^><^^^^<v>^^<>^v<<<<^><<>
^^>^>^>>^<vv>^>>v>^>>>>^v^v^vvvvvv<v<vv^<v>^><^^>v^v<<<<vv<<>v<<v^><^^<<>v>v>>^^<<<<>v^<<v<vvv<v^^>><v^>>v^>^vv<<^v^^vvv^<v^vv>>^^>><v<<^^vvv>^<^<^vvv^><^^>^>^vv^<^v><><<v^><vvv>^>>vv^>^><^^><^v<>^^v^>^<v^^^>v^<^v^>><vvvvv^>><^<>>><^>v^<>^<v>^^<v^><>^><vvv^vv<^>>v>>v<vv>^v<v>vv<v^>^vvv<>>vv^vv>v<>^>^^>vv>^^^^^v>^><<v><>^vv<>v<vvvv^^v^><^<^^>>^<^^^vvv^>^>>>>^>vv<^><><v<<<^>v>>^^<<^v^v<v<<>^<>>v>v>^v^><v<<><<>>>>v>><^<><>v<vvv>^><^<<v>>>vv<^vv<><>vv^^v<v><<v^v>v><v<v^>^<>>^>v<<>>vv^v<vvv^^v><v^v<><v>v>^><>v<><<^>v^v>>>>^v>>>^^vv><<v^<<v>>^^^v>^<<<^>^^>^^>><<>>^v^<vvv<<>^>v^^v>v^v^<><<<^^^^>^v<v>>v<<^v>^><>v>^<<>>^v<^<^v>^<>>v<v^>v<v^>v>>^v>>^<<v<>v>>v<>><vvvvv^>^v>>v<^^^><^v><^<^vv<<v>^v<^>v<<^v<vv^><<>><^<v<>^<v><^<v^<^^v>^vv>>^>^v>vv>vvv>>>^<<v<^<><^^^<<^v<>^><<vv<><^^vv^v<^<^<<vvv<v^vv>v>^^v^vvv^v^v^^^vv>^><vv<>^^<^^<vv<v^v<><^<>vv<v^<vv>^v>^v^vv<<>v><^v>^^>^vvv^^><<<v>v>>^^^>^^^v^<^^>v<v<v<<^vv^>>^<>^^vv<<<<><><>>><><>>v<^v^<<^^<<>>>><v>^<v<>vv^^<>v^^<<>vv^^<vv^^^><>><>v^>v>^<<^v^<><
^^<<^^^<<>><vv^v<vv>^><^<^^^<v>^<<>v>^^vv>v^^^<^<>vvv<v><^<^v^>^^<vv>^><<^<>^>^^^^<v^^vvv<>v<v<^v>><v><<><><<><v^v>^^v>^<vv<>>v>v>v<>><<>^>v<v<v^<vv^v^>^>vv<vv^<>v^><>^^^>>>^^v^^^<<<><<>vv<<>v<>^^>^vv^>>^^>><>^>v>v^>^<>vvv^<v^>^v<^><^>><v<>^v<v^v>v<^^^<^^vv>^><><v<<^<vv^<v^><v>^<v<^<>^>^^^<>v>>^>^^<>^<v<v<>^v>v<<^v^<>vv>v>v<>>vvv<><v><><vvv<>>>>>v^>>>v^<^vv<>v^>vv<>v^^<<>v><>^v^vvv<<v^^<><><<<^^>v>^^<vv<^^>^^vv<><>^<<>^>v>>^<<>v<<^v^<<^v><^<^^<><v^>vvv^<<^^^>><>><v^<v><v<^^>^vv^>vv>>^<>v<^><^^v^vvvvv>^>>>^>>><<<<><<>><><<<<v<^v>>>^^v<><<^vv^^^>v^<v^>^v<><^>v^<>>^^>vv>>><<^<^>v^^<>v>^>vvv>^>v<^>^>v>>>>v><<v<<<^^^^^^>v<>v^>v><^v<<<>^<^><>^<>^<^^v<^^>v<<v>^>vv^v^v<v>v><vv<^^<vv^<v^<^>^^^<<^v^<^<<<^v>^^>><^<v>>v^v>^><v<^v>>v<>^<v>^>^^v<<^^^^>>^<<v^v^^>>>^^^>>v>><>>>v<<v^^<v^^v><<>^><>^<^^^<><>^^<<<<vv>>v^vv^>><<<vv^v>vvv>vv>>^>v><^>v<>v><<<v^^<<^^><<^<><v^>v><^<<v<<<<>^v^<v^>^vv<<v<<vvv^^>^<>v<<<v<v>v<<v><>v<^<v<v<>vvv^^<vv<v>v^>>^v<><^v>>v<>v>v>>^><><vv^^><<<><<<<<>v>^<>><>^v^v>v<v^^>v^>>
>vvvv<v^>^<vv^>>><<<^^v^^v^^<<^^>v>v^><>v^v^^v><v><<<vvvvv^<>>vv><<><vv>v><^<v<>v<<^^v<vv^^v<v>>>>>^>>^<><v^vv<v^^<<^>>v><<^^>>^^v<><v<v^<v<v^<<<v<^v^>v<^v><v>^>>^v<vv>vvv><>^<^>^^<^>>v^v<>>v>v<v>>^^^v>^><v>v>^>v><<vvv<<v>v<<v>v^>>v^>^>><>><<v<<vv<^<>v<>>>^>v<v>^<^<v^<v<v^v>v^<v<^>^v>^^^v^vv^^><vv^>>v<>^v<><<vv><v>^<<vv^><><^vv<^>>>><v<>><^><v<^><^v^v<^^vv>>v^v>><v<<>vv<v^<<>v>>>^<<<v^>>v>^^><>^><>><^v>^><>^<^^v><>>v<v>^vvv>>><v^^><<vv>^^>>^>^v>^>^><vv>^>><^<^^>>>>v>v>^<<<^vv^v>>^>^<^<><^<vv^<v>>v<>v>>vv^>>><>vv^>^vv<>v^v>^v^><<>^<><>v><^^v<<v<<<v>>v^<^<<<v^^vv>^^vv><vv^<>^><>>^vv^<^v><<><><^^^>><<v^vv><^<v>vv><>>v^^<^v>v^^^v^>v>v^vvv<v<vv><<v<v<<^<<><><v>><v^^>v<<>>^<<v^v^<^v>v>v^v^<^vv>vv>>^>>>><vv>>^><<v^<>>v<^^>v^>^>^>^<v<>^>>><v^v>>v^v<>^>v>vv<>v<>>^^<>>^^v>v<>^^^^v><v<vvv>v^v^^v>v^>v<<v<<>v<^>v>^>^^v^>>vv^>v>>>v><>^v<>>v<<<v^>v<vvv<vv<vv<^v<<>>vv^^<<>><vv><^^v>v^^>>v^<v^^>^v>><<<<vv>^^<^v>>^>^^v^^>^>^<<v^>^vv<^^^^^<<vvv>><v^v>>^<<vv<v<>><vvv>>v<<><>>vv^><<<v>><^><<vvv^>^><>^^<<<>
<vv>v^<><<v^^<v<>v>v^<^^vvvv^>><v^^v>>v<v^vvv<v>^^<>><<><v^v>vv^^<v<<>>^^<^>vv>^^^<^^v<>>^>>v^vvv><<^><v>><vv^<^>v<^>^^^v<<>^^^>^v><^<^^<>vv>vvv>^<v^v>>>^>><<v><vv^<^v>v>>>><v^><>^^^>^<>vv^v^<^v<>^>vvv^>^<^>^>v^v<<>>^><^<^^^vv<><v<^<^<^^^<v^v<v^>><^<^v>^^<>^>v<v>^v^<^v<>^v<<<^^^v^><v>^^^^^vv<^vv>^v><><>v^^^>v>^><>v^<<vv^^<>vv><^v^<>>^<^v^<<v<<v<<>>>^v>v>^^^^><vv^v^<<^>vvvv^>v>^^>v<^^>>v<^v<^v^>^<^v^v<<v>^v<<^vvv<^<^vv<v<vvvv<><<^^v>vv<<^^>^^^^>>^vvv^vv<<v>v<^v<<<v<v>v>v>>^<<v<^^<v<^^><<<^^><v<^><>vv>^v^<v^<<>^<<>><^>^^^^v<v<<^>>v<^v<^<v<^^v>>^v^^vv^<<^vv<^^>>>v^><v<^^v<^<<^v^^<<<^>^>^v>>^<<<<<<v<><^>^<^<^<^<v<<>^<^<^<><>^>>^<<^^^v<>><v><<v<v<v><^>^>^<vv^>^v<^vv>^^>vvvv^<>v<^v<v^<><^><v^<v><<>v^v<>v>^vv>^^<><v>>^<^^^<vv>>v^<<<vv^>v>^>>^v<<><^^^><v^^v<v>v<<^>><^>><<<^^v^v^<<^<^>^>v><v<>vv>v><>><>v<>vv^^v>v<^vv^v^v<<<>>><>><><v^<v^^<<<^><^>v<vv>vv^><v<><<v^v<<<v<>^vv<<^>v><>^>^^>><<><>v>^^^>v>^vv<>><v^v<>^<^^^^^>vv>v<^^<<v<>>>^^<v>^><^>v<v<<<><>><v><<^<<^^>v<<v<<^<vv<^^^^>>v^>vvv<<<><>^<v
>^v^^vvvv^>^^^<<^vv>v^v^><vv<^>^>>^^><>^^v<v<>^^>><v^<<>^>>^>v<>>vvv<v^<>^>>^v><v^<<v^v<vv^v^v>v<^v^>><^vvv^^^>>^<v<>>><vv>^<<vv<<^^<^v^v<>v>>>^^>^>^>>^^>><^^^v<vv>v><^><>v<v><<>><<<<<^v<><v^v>^vv<<v>^^vv<v<>vv><>>^<^<<>><>>><v^^>>^v<<>>^<<>>>><>v>v^^<><v>v>>v^<v^^vv^v^v<^^>^v<v><v>><<>>v<<v>v^vv>vv^^^<>^>vv<<^v<>v^<^<<v^<^^<vv>v>^v><<<>>>v^^<>>><^v>><v<>v^>^v<<v^>^<v^v<vvv><>^>>><^v>v<<<v<^v^v<^>>v>^>v^<<<<^vv>v<>^<v<><<>>^v^<^^<>><v^^^v<v>v<<^>>v<>^v><<^<>>^>^<<^<vvv^v>>>v>>^^^>v<><><<^>v>>vv><v<^v>v^^^v<<^v>><>>vv^^>>^<>>>v><v>v>>><^v>>><v<^v<>v>v>vv>^>^<>>>vv^<v><>>v<v><<^>^>^<^^>>v>v>>v^^<<^vv><vv>^>^v^>^vv<v^v><<<<<>>>^>^v><v><<v<><^<<^^^>><>^vv^v><^<^^^<^^^v>>>v^^<<v^<<>v>v^<>>^>^v><<vv><>^<^>><^>^v>>^<^>>>>^<<v<^<^<><>v>^<^v><v>vvv<<<>>v>^^<^v>^>v^><<^>>>><<v<^vvv>v<v^><<>^>v^><<<>^><^><^>>>^>>><vv>><vvv<>>v>^^<><^>^^<>^^<>v^^^^<<^v^^<>v>><^<<^<<<<<><^<^<v^^<v<><^^>>^v^<^>vv^<^<<v>>^^v<vv^v^>v>vv>^<<>>><><<^^><v<^<^v^>^v^>vvv>^<<^<>v^v^><<<^v<v^v<<<>v><<<v<v<<>^v><<<>v<^vv>v>>^
^><<v<^vv<^>>v^<v><vv^^^v>^^>v<><v<>v^><v<^^v<v>vv^<v^v>^^<v^v^>^>>^<>vv<>^v<><<<<<><^>vvv>><>^^^<^<><<^v><><><^v<v>>^<<^vv^vv^v>v<^>^<v>><v>^^<<><^^vv><>>^^^><><^><^>v^<^v><vv>>>><<><vv^<^vv^>v<<^^v><v^>^<^<v^v><>>>>^><^^>^>^v^<vv>^^<<<>>v^^^v<>vv<^^><v^^<>^<>vv<^><^v><v^<<>v^^^>^^<^>^<<^<>v<^v><>^>v>v>v>^<<vvv><vvv^v>^^^>v^<^v^vv^^<^^>^<>v<<><<>v^<<vv<^>vv^v^v<vv<^>>^>>v<<>>>>>><>v>v>^<^^<vv>^v^><>>><>^vv^>v<v<^^v<^><>><<^<v<^<<<<<<v<vv><>^>>^><v><>^^>>>^>v<><><<^<>v><^<<v<><^<^<>^v<vv>v<>v><^>v<v<>v^>^^vvvv^^v^vv^>>vv>v^^<^<v<^^v><^><v^<<>><^><v>vvv^<<>>v^^><^><>><^^v><>v<^v^^vv>>v<<>>^<^v>v<^><><<<^>><>v^^<<^><^v<>v>v>^^v^<^><<<^><<>v^^<v^<<<v>v<^^><><^>>v^<>vv<<<v^<v<^<<^>v>^>>><>vv<v><<><<vv<<^^<>^<^^^<>><>^<^v<>^^^<<><v<>>^<<vv^^>vvv>><^>^^v>^^>^>v^v>^>^><>v>v>vv>v^<^>^>^<>v>>v<<v^>^<<<vvv^<<>v^vv>v^<<^>vv>>^vv>>vv<<v>><^^>^>^v>><<^^>^^v^<>>v^v<vvvv><v>>^>>>>vv<<><^^v^^^^^>^>>v<>^v^<^<<<><^>^<v>^v<<>v><vv^v^<^^v>^^<v^>v^<>><<^^<<vvv>v<><<<<vv>^^>>v^<^>>v>><v>^vv<^v<^>v<^^vv>vv<<
vv<><v^^><v>^^^v<v^<<><v^^><v<<<><^^vv>^v<<v<>><><vvv<^v>>^><v^vv>>>^>vv>><>>^<<v><^><v^>v><<>>^>^v>>v^^<^>vv>>>><vv>^>v><^<>^<>>^<vv^^<v>^<<>v<<<>v^<^^v><>^^^><^^<^<><^v<^^<<v^^>>^<vv>>^>v<<<<v^>^^v^><><<><^<^<^<^><v<^^vv>>v^<>^<>^>^v<^^v<>v^<>v<vv>vv<<<v^<>v<>>>^>^vv^<>v>^v>v>^<vvv^^<<^<v^<>>^v<>>^<>v<v>^>>>>^>^v^^<^>^v<^>v>^><<>><<vvv<^^<>v><vv><>v<v^>^^^<vvvvv<>^><^v>><>v^><<^<><v<<<^<v^<v^^v<v<^vv^v>^>vvv^v>><v>^vv^<v>><<^<>v>v>vv^^v<v>^^v<v<vvv<<>vv<v>v^>v^><^^<^^<>vv^<v<<^>^^<^><<>vv^<v<<v><<^<v^<^>v<^<>><v>^vv^<>v<^^<v^<>vvv>v^>^^<^>>v<<<>^vv^<v^<^<^^^v<>>^^^v^<<<>^^>>v^>>^<v>vv^<^^><^><v<>>>^>v<^v>v^><<vv>vv<vv<>><v^v^<vv>>v><<<><vv<>^v<^>^>v^^<v<<^^v^<<>v><>>>><<v>^v>^<vv^v>vv^<>>^<v^vv^vv^>v><v<><v><<^v^v>^^<><<<^<>^v<<^v^v^v><^>^v><>^v^^^>v^><<^>v<<>>vv>v^>><^^>><<^<v>^<<^v<>>>^v^<><<<>^<<<<<<<vv<>^^^^<><vvv>^>>v<v^v<<>v<v>><^v>^v<v>^<^v><<<vvvv>v<^^^<<<>>^><^<v>^<^^>^v^^<v>v>^v^>v^vv^>^vv<<<<>^^v><>v<^vv^>><<^<>v>^v^<>><v><vv^>^<>v<><><<<v<^>v>><<^<^^>v^>vvv^^>>>>>^>^<>^v<
>>v^^<>>><<vv>v>>>v<v<>^vv>^^v^^<v>>^v>>^vv<v^<^<^v>^^^v^>>>>v><vvv>^>>^<v^<^^^<^v<<^^><^<^^><<^^>v<<v^^v<<>>><>^v>vv<>>v^><>^<vv<><^<<>><<v^<<>v<v><^><^^<^v<^v^<vv>^<v<>^v>v<>v>^v<^v>v^<vv<><v>v<vv^<v^^^<v<>v<><>^>v^<<>>vv>v^>^<^^<vv><<<<<<v^vv<<<>^^v^<^^v^vvv<vv>^v<vv^v<v<><<v^^>^v<>>^<<v>v>^><^>v<<>^<>>>vvv>><^^^>v<<v^^^>><^>^v^<^v><<<v<^>>^>v<>>><>v<<<^>^<^^<>^^>^^<<vv^<<vv>^^<^<><vv^>^v<<<<>v^><>>>>><^^v^^^<vvvv<^>vvv^>v>>v<<^v<<<^vv>><<<>vvv<>><>^^>vv^<<^v>v^<^><vv>^^>>v^v<<>><^v>>vv<^>vv^v<v^>v<^<vv>>>>v<><<vv^^>v>v<>vv<^<<<<<^>v<<<>vv^^^^^<v><<><<^v><>v><^<<v<>>><<vv><^>>><<^^^>><^^vvv<^^>v^v<v^<>v<v^vv^vv^<vv^<<<^<^vv>^v^v>vv^^<^<v^v^>^^<>v>^><^^<v^<^<vv><>vv>>v^v>>>>^v^v<<>>vvvv<^v>v^<^<>^^><<v<><^<>><><v<<><^^^><<>>>v><v<<><<vvv^v^^v>v<^<>^>^v>v>v^^^^^>>v>vvv<^>v<^v>v>v>^<^<^>v<><^v>v>v>>v<<>>^<<<^>v><>>><^><vv>v<<><<vv^>><v<v>^><<vv^>>><>v<vv<>>^<v^<<>v>^<^v<<><v^><^<^v>vv>>><vv<v><v>v>^^>v>v><vv<>^^><<^v<v^>v><<<<^^><^^<>vv^vv^^<<^<v<^vv<<^vv^^^<^<v>^^^vv><><^vvv<><>^v<v^<
^<<v<^><v>><^<<<^<^>v>^v^<^<^<^vv>v^>>^<>>^^<<v>^><v^v<v^^^>>>^<^><^^^v<^^<v>>^>v>v<>v<<<><^vvv^<v><v>v<>>v<><^^<v><><<v<<<vv<<v<^v<>><>^vv><v>>v^<^<^v^<^><<^<<>vvv>><>>vv<v^v>><^v<<v^<^>vvv^^v^>^<v^v>><>^>>^^v^<^v^<v^vv^vv^>v><<>v>^<v^^v^<><v^^^vv^v^^vvvv^v<>vv<^<v<><^^^>>vv<^<<vv^v^<v>v><^v>v^<vv>^v>^<^^v<^^>^vvv>^<vv<<<^<^>v<<^^^^<^^<v><v^<><^>vv>^v><^>>><>vv^<>^>v^>v<><><^<v<><v<<v^>v^^^><<v<><>>^^^><^^v^<<>^>^<vvv^><v^<<vvv^v^><^>v>v<>^<>^^>><v^>>>v^v<v<<v>>^>><<^vv<>^^^>>v><v>v>^^^>^<^^<^>v<v<>^<>^^<^>^^^^vv<><<<>><<v<><v<v<><v^^^>v<><>^<^vvv^>vv^^v<>v<>^<^<>><><^>>>v<<<>vv<>>>^^vvv>^<<<>^v<v<vv>v<v>vv>>^<^><>^>>^vvv<>v><^^v>^^<<>><<vv^>^v<>^v<<<>^^^>>>^>v<<<<^^><<>v^>>><>>^><^^><><^<^<<v><vv<<v><<<<>^>v>^<><>vvvv^><^^^>^>>><<>vv>v>>>^v<>vvv<<^>>>^v>>vv><v<^^vv^>^>^^>^>^vv<^^^>v<v^><^>>>^^>>v<^v>v<<v>vv><v<^v^^>><>^v>>><^vv><<^^v>^>v>vv^^^<<>v<v>^^>^<>>v^v>^>^>v^>^<v>^><^^>^v^<<v<v<^^v<v<<v^>vv>>^^v>>^>^vv<>><>^^>v>v<vvv<>>^<v^v^>v^<><vvv^v<>>v><>>>>v>>v>><><v<v^<v<<<>vvv<^v<>><^
""".strip()

from pprint import pp  # noqa


@dataclasses.dataclass(frozen=True)
class Position:
    x: int
    y: int


Floor = dict[Position, str]

ROBOT = "@"
WALL = "#"
BOX = "O"
SPACE = "."


def parse(raw):
    raw = raw.strip()
    floor_str, movements = raw.split("\n\n")
    floor = {}
    x = y = 0
    robot_pos = None
    for y, line in enumerate(floor_str.split("\n")):
        for x, char in enumerate(line):
            pos = Position(x, y)
            floor[pos] = char
            if char == ROBOT:
                robot_pos = pos
    return (
        floor,
        movements.replace("\n", ""),
        x + 1,
        y + 1,
        robot_pos,
    )


def floor_to_string(floor: Floor, width, height):
    s = ""
    for y in range(height):
        for x in range(width):
            s += floor[Position(x, y)]
        s += "\n"
    return s


def move_item(floor: Floor, from_pos: Position, to_pos: Position):
    floor[to_pos] = floor[from_pos]
    floor[from_pos] = SPACE


def do_move(floor: Floor, move: str, item_pos: Position) -> Position:
    if move == "^":
        to_pos = Position(item_pos.x, item_pos.y - 1)
    elif move == ">":
        to_pos = Position(item_pos.x + 1, item_pos.y)
    elif move == "v":
        to_pos = Position(item_pos.x, item_pos.y + 1)
    elif move == "<":
        to_pos = Position(item_pos.x - 1, item_pos.y)
    else:
        raise Exception(f"Invalid move: {move}")

    if floor[to_pos] == SPACE:
        move_item(floor, item_pos, to_pos)
        return to_pos

    if floor[to_pos] == WALL:
        return item_pos

    new_pos = do_move(floor, move, to_pos)
    if new_pos == to_pos:
        # The box didn't move
        return item_pos
    else:
        move_item(floor, item_pos, to_pos)
        return to_pos


def checksum(floor: Floor) -> int:
    total = 0
    for pos, item in floor.items():
        if item == BOX:
            total += 100 * pos.y + pos.x
    return total


def main(puzzle_input):
    floor, moves, width, height, robot_pos = parse(puzzle_input)
    step = "step" in sys.argv
    for i, move in enumerate(moves):
        if step:
            print(floor_to_string(floor, width, height))
            print(f"Step {i}")
            print(f"Next move: {move}")
            input("Press Enter to continue...")
        robot_pos = do_move(floor, move, robot_pos)
    print(floor_to_string(floor, width, height))
    print(checksum(floor))


if __name__ == "__main__":
    # main(_input_md)
    # main(_input_sm)
    main(_input_lg)
